## 开始前
社区关于UI组件库开发的文章确实比较少，在参考过一些资料和开源的UI组件库后，写下了这篇文章，希望能给大家一些启发。

好了，废话不多说，直接开始！


## 搭建项目
本次开发没有基于Vue CLI来搭建开发环境，而是基于我上次Webpack4自己搭建的环境来构建的环境，虽然官方CLI也可以，而且也有自己的库模式来发布组件库。但是为了能够更多的有自己自定义的选项，还是没选择官方脚手架。如果你想要使用官方CLI来开发，那么本文章虽然不能手把手教你，但应该还是可以起到抛砖引玉的作用。

接下来我们需要做这几步，先把目录结构定下来：
- 克隆下该项目[customized-vue-proj-mobile](https://github.com/cookiepool/customized-vue-proj-mobile)
- 修改项目的目录结构如下图所示。

![1.png](https://i.loli.net/2019/12/24/biHQqsyGXcM3fBI.png)

> examples文件夹下用来展示你的组件基本用法。其实相当于把src的文件目录改为了examples

> packages文件夹下用来书写你的组件。

> 修改了结构后还涉及到一些细微的修改，比如文件夹改为你项目的名字（我这儿叫cookie-ui），package.json里面的name根据自己的需要来修改。

同时我们需要修改我们的入口，因为默认搭建出来的入口是src。在bulid目录下修改webpack.config.js中以下代码：
```
module.exports = {
  /* 省略代码 */
  entry: {
    main: path.resolve(__dirname, "../examples/main.js")
  },
  resolve: {
    /* 省略代码 */
    '@': path.resolve(__dirname, '../examples')
    /* 省略代码 */
  }
  /* 省略代码 */
}
```
这样一来，再把examples改造一下，便于我们写演示代码。examples目录如下图：

![2.png](https://i.loli.net/2019/12/24/iEI6JFRbcj5kKlo.png)

这个文件夹目录的结构就跟我们平时做单页面开发一样，这里我就不再赘述各个文件夹的功能，其实这个结构也不是非得这样来布置，可以根据自己的情况来规划目录即可。

## 编写组件库
重点主要在packages目录下组件库的编写，目前我的目录结构如下所示：

![3.png](https://i.loli.net/2019/12/24/VBNdJKjvapZTmWl.png)

- components 存放你的组件。
- style 存放你的相关的样式，组件单独的样式我放在了组件目录里面管理了，比如图片你面的button.scss。
- index.js 组件库的注册和导出都在这里。

> style文件夹下的样式大家根据自己需要来规划就好，不一定按我这个方式来

### 1、普通组件
接下来我以一个button组件来举例，先按图建好相关文件，相关代码我会加一些注释，如果你不太清楚Vue插件开发，Sass等这些知识点建议先学习一下相关知识，这里不再展开。

![4.png](https://i.loli.net/2019/12/24/hKHGNgpTle2F7Lx.png)

- button.scss
```
@import '../../style/common/variable.scss';
.cookie-button {
  position: relative;
  display: inline-block;
  width: 90px;
  height: 40px;
  line-height: 40px;
  border-radius: 4px;
  outline: 0;
  border: 0;
  appearance: none;
  color: #fff;
  font-size: 16px;
  &.cookie-button--primary {
    background-color: $button-primary;
    border: 1px solid $button-primary;
  }
  &.cookie-button--danger {
    background-color: $button-danger;
    border: 1px solid $button-danger;
  }
  &.cookie-button--warning {
    background-color: $button-warning;
    border: 1px solid $button-warning;
  }
  &.cookie-button--info {
    background-color: $button-info;
    border: 1px solid $button-info;
  }
}
/* 加这个代码是为了让按钮点击看起有个反馈效果 */
.cookie-button::before {
  position: absolute;
  content: "";
  left: 50%;
  top: 50%;
  width: 100%;
  height: 100%;
  background-color: #000;
  opacity: 0;
  transform: translate(-50%, -50%);
  border: inherit;
  border-color: #000;
  border-radius: inherit;
}
.cookie-button:active::before {
  opacity: 0.1;
}
```

- Button.vue
```
<template>
  <button :class="classSet" @click="handleClick">
    // 这里使用了插槽知识
    <slot></slot>  
  </button>  
</template>


<script>
export default {
  name: 'ck-button',
  props: {
    type: {
      type: String,
      default: 'primary'
    }
  },
  computed: {
    classSet() {
      let classResult = `cookie-button cookie-button--${this.type}`;
      return classResult;
    }
  },
  methods: {
    handleClick() {
      this.$emit('click');
    }
  }
}
</script>
```

- index.js
```
// 配置对外引用
import Button from './Button.vue';
import './button.scss';

// 提供install方法
// 这里提供一次install是为了便于单独引入buttton组件时进行注册
// 我们在根目录的
Button.install = function(Vue) {
  Vue.component(Button.name, Button);
};

// 默认导出方式导出
export default Button;
```
这样我们就实现了一个简单的按钮组件。
我们到根目录的index.js下进行install。在index.js中加入以下代码：
```
/* 组件库对外导出的组件集合，对整个组件进行导出 */

// 导入组件（用于注册所有组件）
import Button from './components/button';


// 定义组件列表
const componentsList = [
  Button
];

const install = function(Vue) {
  // 判断是否安装过
  if(install.installed) return;

  // 注册所有组件
  componentsList.map((component) => {
    Vue.component(component.name, component);
  })

  Vue.prototype.$toast = Toast;
  Vue.prototype.$dialog = Dialog;
}

if(typeof window !== 'undefined' && window.Vue) {
  install(window.Vue);
}

export default {
  install,
  Button
}
```
然后我们进入我们的examples目录来展示我们的按钮组件，在main.js中全部引入
```
// 引入组件（注册所有）
import CookieUI from '../packages/index.js';
Vue.use(CookieUI);
```
在组件中使用按钮：
```
<div class="box"><ck-button type="primary" @click="testClick">基本按钮</ck-button></div>
<div class="box"><ck-button type="danger">危险按钮</ck-button></div>
<div class="box"><ck-button type="warning">警告按钮</ck-button></div>
<div class="box"><ck-button type="info">信息按钮</ck-button></div>
```
- 注意：<ck-button>这个跟你写的组件的name属性相关（比如我这里就是Button.vue里面的name属性），名字只要符合规范即可。

![5.gif](https://i.loli.net/2019/12/24/cXAVg2aOG6FBbev.gif)

### 2、modal组件
这种组件不需要Vue.component()方法来注册，比如常见的Toast、Dialog，我这儿是直接绑定到Vue原型上，在项目里面可以直接使用this调用。
